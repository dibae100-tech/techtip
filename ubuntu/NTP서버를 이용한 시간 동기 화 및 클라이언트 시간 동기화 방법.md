μ°λ¶„ν¬ μ„λ²„μ—μ„ μ‹κ°„μ„ λ™κΈ°ν™” μ‹ν‚¤κ³  λ΅μ»¬ μ„λ²„ μ™€ ν΄λΌμ΄μ–ΈνΈλ¥Ό λ‹¤μ‹ μ‹κ°„ λ™κΈ°ν™” μ‹ν‚¤λ” λ°©λ²•μ€ 2κ°€μ§€λ΅ μ„¤μ • ν•΄μ•Ό ν•λ‹¤. 



### 1. NTP(Network Time Protocol) μ„λ²„λ¥Ό μ„¤μΉν•κ³  μ„¤μ •ν•λ” λ°©λ²•

   μ„¤μΉ ν•λ” λ°©λ²•μ€ 2κ°€μ§€κ°€ μλ”λ° chrony λλ” ntpdλ¥Ό μ‚¬μ©

#### 1) chrony μ„¤μΉ  

    sudo apt update
    
    sudo apt install chrony -y

μ΄λ ‡κ² ν•κ³  ν™κ²½ μ„¤μ • μΌλ΅ λ“¤μ–΄ κ°„λ‹¤.

      sudo nano /etc/chrony/chrony.conf


      # Chrony Configuration File
      # λ΅μ»¬ Chrony μ„λ²„ μ„¤μ •
      
      server 127.127.1.0 iburst
      local stratum 10
      
      # μ™Έλ¶€ NTP μ„λ²„ (μΈν„°λ„· μ—°κ²° μ‹)
      server time.google.com iburst
      server 0.pool.ntp.org iburst
      server 1.pool.ntp.org iburst
      
      # λ΅μ»¬ λ„¤νΈμ›ν¬μ—μ„ NTP μ„λΉ„μ¤ ν—μ©
      allow 192.168.0.0/24
      
      # μ‹μ¤ν…μ΄ μΈν„°λ„·μ— μ—°κ²°λμ§€ μ•μ•μ„ λ• RTC λ™κΈ°ν™” μ‚¬μ©
      # rtcfile /var/lib/chrony/rtc
      
      # λ“λ¦¬ν”„νΈ νμΌ μ €μ¥ μ„μΉ
      driftfile /var/lib/chrony/chrony.drift
      
      # μ‹κ°„ μ΅°μ • μ„¤μ •
      makestep 1 3
      
      # λ΅κ·Έ μ„¤μ •
      logdir /var/log/chrony
      
      # 11λ¶„λ§λ‹¤ μ»¤λ„ RTC λ™κΈ°ν™” ν™μ„±ν™”
      rtcsync

#### 2. Chrony λ™κΈ°ν™” μƒνƒ ν™•μΈ
 
      sudo systemctl restart chrony
      
      systemctl status chrony

<img src="../img/chrony01.png" alt="μ‚°μ—…μ©PC" width="900">


#### 3.chronyc tracking, chronyc sources -v λ¶„μ„ 

      Reference ID    : 6AF7F86A (106.247.248.106)  # ν„μ¬ μ°Έμ΅°ν•λ” NTP μ„λ²„
      
      Stratum         : 3                            # ν„μ¬ λ™κΈ°ν™”λ Stratum λ λ²¨
      
      Ref time (UTC)  : Sun Mar 09 15:23:47 2025    # λ§μ§€λ§‰ λ™κΈ°ν™”λ μ‹κ°„ (UTC)
      
      System time     : 0.000000017 seconds fast    # ν„μ¬ μ‹μ¤ν… μ‹κ°„κ³Ό NTP μ‹κ°„ μ°¨μ΄
      
      Last offset     : +0.005524827 seconds        # λ§μ§€λ§‰μΌλ΅ λ³΄μ •λ μ¤μ°¨
      
      RMS offset      : 0.005524827 seconds         # λ³΄μ •λ μ¤μ°¨μ ν‰κ· κ°’
      
      Frequency       : 15.212 ppm slow             # μ‹μ¤ν… ν΄λ­ μ£Όνμ μ΅°μ •κ°’
      
      Residual freq   : +210.061 ppm                # λ‚¨μ€ μ£Όνμ λ³΄μ •κ°’
      
      Skew            : 5.749 ppm                   # μμƒ μ¤μ°¨
      
      Root delay      : 0.041864853 seconds         # NTP μ„λ²„κΉμ§€ μ™•λ³µ μ§€μ—° μ‹κ°„
      
      Root dispersion : 0.017857527 seconds         # λ£¨νΈ λ¶„μ‚°(μ¤μ°¨μ¨)
      
      Update interval : 1.4 seconds                 # NTP μ—…λ°μ΄νΈ κ°„κ²©
      
      Leap status     : Normal                      # μ •μƒ μƒνƒ


      β΅ ν„μ¬ 106.247.248.106 (Stratum 2) μ„λ²„μ™€ μ •μƒμ μΌλ΅ λ™κΈ°ν™”λ¨
      β΅ μ‹μ¤ν… ν΄λ­μ΄ μ•μ •μ μΌλ΅ μ μ§€λκ³  μμ

      MS Name/IP address         Stratum Poll Reach LastRx Last sample
      
      ===============================================================================
      
      ^? localhost                     0   7     0     -     +0ns[   +0ns] +/-    0ns
      
      ^- time4.google.com              1   6    17    57  -3529us[-3529us] +/-   31ms
      
      ^* 106.247.248.106               2   6    17    57   +341us[+5866us] +/-   26ms
      
      ^- 121.174.142.82                3   6    17    57  -2048us[-2048us] +/-   51ms

      MS: ^*(ν„μ¬ μ„ νƒλ μ„λ²„), ^-(λ³΄μ΅° μ„λ²„), ^?(μ‚¬μ© λ¶κ°€λ¥ν• μ„λ²„)
      Stratum: μ„λ²„μ Stratum λ λ²¨ (μ«μκ°€ λ‚®μ„μλ΅ λ” μ •ν™•ν•¨)
      Poll: μ‹κ°„ λ™κΈ°ν™” κ°„κ²© (2^Poll μ΄)
      Reach: μ„λ²„μ κ°€μ©μ„± (8λΉ„νΈ 0~377, λ†’μ„μλ΅ μΆ‹μ)
      LastRx: λ§μ§€λ§‰ λ™κΈ°ν™” μ‹κ°„(μ΄)
      Last sample: λ§μ§€λ§‰ μƒν” μ¤μ°¨κ°’ λ° μ΅°μ •κ°’
        
      β… ^* 106.247.248.106 (Stratum 2) μ„λ²„κ°€ ν„μ¬ μµμ μ λ™κΈ°ν™” μ„λ²„λ΅ μ„ νƒλ¨
      β… ^- time4.google.com (Stratum 1)μ΄ λ³΄μ΅° μ„λ²„λ΅ μ‚¬μ© μ¤‘
      β… ^- 121.174.142.82 (Stratum 3)λ„ μ—°κ²°λμ–΄ μμ§€λ§ μ°μ„ μμ„κ°€ λ‚®μ
      β ^? localhostλ” Reach κ°’μ΄ 0μ΄λ―€λ΅ μ‚¬μ©ν•  μ μ—†μ
      
#### π― μ¶”κ°€ μ΅°μΉ (μ„ νƒ)

      RTC(ν•λ“μ›¨μ–΄ ν΄λ­) λ™κΈ°ν™” ν™•μΈ
      hwclock --show
      λ§μ•½ μ‹μ¤ν… μ‹κ°„μ΄ RTCμ™€ λ§μ§€ μ•μΌλ©΄ μ•„λ λ…λ Ήμ–΄ μ‹¤ν–‰:
      sudo hwclock --systohc
      
### 2. ν΄λΌμ΄μ–ΈνΈ μ„¤μΉ ν•κΈ° 

#### 1) μ†ν”„νΈμ›¨μ–΄μ„¤μΉ 

      sudo apt update 
      
      sudo apt install chrony -y

#### 2) ν™κ²½ μ„¤μ • 

      sudo nano /etc/chrony/chrony.conf


      # ν΄λΌμ΄μ–ΈνΈμ Chrony μ„¤μ •
      
      # λ‚΄λ¶€ λ„¤νΈμ›ν¬ NTP μ„λ²„ (192.168.0.4) μ‚¬μ©
      server 192.168.0.4 iburst prefer
      
      # (μ„ νƒ μ‚¬ν•­) μ™Έλ¶€ NTP μ„λ²„λ¥Ό λ°±μ—…μΌλ΅ μ¶”κ°€ κ°€λ¥
      # server time.google.com iburst
      # server 0.pool.ntp.org iburst
      # server 1.pool.ntp.org iburst
      
      # λ“λ¦¬ν”„νΈ νμΌ μ €μ¥ μ„μΉ
      driftfile /var/lib/chrony/chrony.drift
      
      # λΉ λ¥Έ μ‹κ°„ μ΅°μ •
      makestep 1 3
      
      # λ΅κ·Έ μ„¤μ •
      logdir /var/log/chrony
      
      # 11λ¶„λ§λ‹¤ RTC λ™κΈ°ν™” ν™μ„±ν™”
      rtcsync
      
#### 3) μ‹¤ν–‰ λ° λ™κΈ°ν™” ν™•μΈ 

      sudo systemctl restart chrony
      
      chronyc tracking

      chronyc sources -v

<img src="../img/chrony02.png" alt="μ‚°μ—…μ©PC" width="900">
      
      Reference ID    : C0A80004 (192.168.0.4)  # ν„μ¬ μ°Έμ΅°ν•λ” NTP μ„λ²„ (192.168.0.4)
      Stratum         : 4                        # ν„μ¬ Stratum λ λ²¨
      Ref time (UTC)  : Sun Mar 09 15:53:05 2025 # λ§μ§€λ§‰μΌλ΅ λ™κΈ°ν™”λ μ‹κ°„ (UTC)
      System time     : 0.000000026 seconds slow # μ‹μ¤ν… μ‹κ°„μ΄ κ±°μ μ •ν™•ν•¨
      Last offset     : +0.000021575 seconds     # λ§μ§€λ§‰ λ³΄μ •λ μ‹κ°„ μ¤μ°¨
      RMS offset      : 0.000021575 seconds      # ν‰κ·  μ¤μ°¨κ°’
      Frequency       : 52.940 ppm fast          # μ‹μ¤ν… ν΄λ­ μ†λ„ μ΅°μ •κ°’
      Residual freq   : +15.496 ppm              # μ¶”κ°€ μ΅°μ •κ°’
      Skew            : 2.868 ppm                # μ¤μ°¨μ¨
      Root delay      : 0.040557820 seconds      # NTP μ„λ²„κΉμ§€ μ™•λ³µ μ§€μ—° μ‹κ°„
      Root dispersion : 0.009221659 seconds      # λ£¨νΈ λ¶„μ‚°(μ¤μ°¨μ¨)
      Update interval : 2.0 seconds              # NTP μ—…λ°μ΄νΈ κ°„κ²©
      Leap status     : Normal                   # μ •μƒ μƒνƒ

      β΅ 192.168.0.4 NTP μ„λ²„μ™€ μ •μƒμ μΌλ΅ λ™κΈ°ν™”λ¨
      β΅ Stratum 4 (192.168.0.4κ°€ Stratum 3μ΄λ―€λ΅, ν΄λΌμ΄μ–ΈνΈλ” Stratum 4)
      β΅ μ‹μ¤ν… μ‹κ°„μ΄ κ±°μ μ •ν™•ν•κ³  μ•μ •μ μ„ (μ¤μ°¨κ°€ +0.000021575sλ΅ λ§¤μ° μ μ)


      MS Name/IP address         Stratum Poll Reach LastRx Last sample
      ===============================================================================
      ^* 192.168.0.4                   3   6    17    19  -7002ns[  +15us] +/-   29ms

      π” μλ―Έ
      MS (^*) β†’ ^* β†’ ν„μ¬ μµμ μ NTP μ„λ²„λ΅ μ„ νƒλ¨
      Stratum 3 β†’ 192.168.0.4λ” Stratum 3 (μ¦‰, μƒμ„ Stratum 2 μ„λ²„μ—μ„ λ™κΈ°ν™”λ¨)
      Poll 6 β†’ ν„μ¬ Poll κ°„κ²©μ€ 2^6 = 64μ΄
      Reach 17 β†’ μ„λ²„ κ°€μ©μ„±μ΄ μ •μƒ (Reach κ°’μ΄ 0~377 λ²”μ„μ—μ„ μ¦κ°€ μ¤‘μ΄λ©΄ μ •μƒ)
      LastRx 19 β†’ λ§μ§€λ§‰ λ™κΈ°ν™”κ°€ 19μ΄ μ „μ— λ°μƒ
      Last sample -7002ns[ +15us] β†’ μµκ·Ό μƒν”μ—μ„ 15 λ§μ΄ν¬λ΅μ΄(Βµs) λ³΄μ •
      β… ν΄λΌμ΄μ–ΈνΈκ°€ 192.168.0.4μ™€ μ™„λ²½ν•κ² λ™κΈ°ν™”λ¨! π€

#### 4) μ»΄ν“¨ν„° μλ™ μ‹¤ν–‰ λ“±λ΅ 

      sudo systemctl enable chrony
      
      systemctl is-enabled chrony

### 3. μ ‘μ† ν΄λΌμ΄μ–ΈνΈ ν™•μΈ ν•κΈ° 

      grepμ„ μ‚¬μ©ν•μ—¬ ν•„ν„°λ§
      
      sudo chronyc clients
      sudo chronyc clients | grep "192.168.0."

### 4. μ‹μ¤ν… κµ¬μ„± μ„¤λ… λ° DFD κµ¬μ„± 

#### DFD: Chrony NTP μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ™κΈ°ν™” ν”„λ΅μ„Έμ¤

μ΄ λ‹¤μ΄μ–΄κ·Έλ¨μ€ Chrony NTP μ„λ²„(192.168.0.4)μ™€ ν΄λΌμ΄μ–ΈνΈ(192.168.0.x) κ°„μ μ‹κ°„ λ™κΈ°ν™” νλ¦„μ„ λ‚νƒ€λ‚Έλ‹¤.
Chronyλ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‹¤ν–‰λλ©°, NTP(Network Time Protocol)λ¥Ό μ‚¬μ©ν•΄ μ‹κ°„μ„ λ™κΈ°ν™”ν•λ‹¤.
___

#### 1. μ „μ²΄μ μΈ νλ¦„
   1οΈβƒ£ ν΄λΌμ΄μ–ΈνΈ(192.168.0.x)μ NTP μ”μ²­

   ν΄λΌμ΄μ–ΈνΈλ” NTP μ„λ²„(192.168.0.4)λ΅ μ‹κ°„μ„ μ”μ²­ν•λ‹¤.
   μ”μ²­λ λ°μ΄ν„°λ” NTP Requestλ΅ μ „λ‹¬λλ‹¤.

   2οΈβƒ£ Chrony μ„λ²„(192.168.0.4)μ μ‹κ°„ μ‘λ‹µ

   Chrony μ„λ²„λ” ν„μ¬ μ‹κ°„μ„ κ³„μ‚°ν•κ³  ν΄λΌμ΄μ–ΈνΈμ— μ‘λ‹µν•λ‹¤.
   μ΄ μ‘λ‹µμ€ NTP Responseλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈλ΅ μ „λ‹¬λλ‹¤.
   3οΈβƒ£ ν΄λΌμ΄μ–ΈνΈμ μ‹μ¤ν… μ‹κ°„ μ—…λ°μ΄νΈ
   
   ν΄λΌμ΄μ–ΈνΈλ” λ°›μ€ NTP μ‹κ°„μ„ κΈ°μ¤€μΌλ΅ System Clock Updateλ¥Ό μν–‰ν•λ‹¤.
   λ™κΈ°ν™”λ μ‹κ°„μ„ ν΄λΌμ΄μ–ΈνΈμ RTC(ν•λ“μ›¨μ–΄ ν΄λ­)μ—λ„ λ°μν•λ‹¤.
   4οΈβƒ£ μ„λ²„μ μμ²΄ μ‹κ°„ μ μ§€
   
   Chrony μ„λ²„λ” Drift Fileμ„ μ΄μ©ν•΄ μ§€μ†μ μΌλ΅ μ‹κ°„μ„ λ³΄μ •ν•λ‹¤.
   RTC(Real-Time Clock)μ™€ λ™κΈ°ν™”ν•μ—¬ μ¬λ¶€ν… ν›„μ—λ„ μ‹κ°„μ΄ μ μ§€λλ‹¤.
 ___  
 
#### 2. μ£Όμ” κµ¬μ„± μ”μ†
κµ¬μ„± μ”μ†	μ„¤λ…

      Client (192.168.0.x)	NTP μ„λ²„μ—μ„ μ‹κ°„μ„ λ°›μ•„ λ™κΈ°ν™”ν•λ” μ¥μΉ
      Chrony Server (192.168.0.4)	ν΄λΌμ΄μ–ΈνΈμ— μ •ν™•ν• μ‹κ°„ μ •λ³΄λ¥Ό μ κ³µν•λ” μ„λ²„
      NTP Request	ν΄λΌμ΄μ–ΈνΈκ°€ NTP μ„λ²„μ— μ”μ²­ν•λ” λ°μ΄ν„°
      NTP Response	μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ— λ³΄λ‚΄λ” μ‘λ‹µ λ°μ΄ν„°
      System Clock Update	ν΄λΌμ΄μ–ΈνΈκ°€ λ°›μ€ μ‹κ°„μ„ μ‹μ¤ν… μ‹κ°„μΌλ΅ λ°μ
      RTC Sync (Client)	ν΄λΌμ΄μ–ΈνΈκ°€ RTC(ν•λ“μ›¨μ–΄ ν΄λ­)λ¥Ό μ—…λ°μ΄νΈ
      Drift File	Chrony μ„λ²„κ°€ μ‹κ°„ μ¤μ°¨λ¥Ό λ³΄μ •ν•κΈ° μ„ν• νμΌ
      RTC Sync (Server)	μ„λ²„κ°€ μμ²΄ RTCμ™€ λ™κΈ°ν™”ν•μ—¬ μ§€μ†μ μΈ μ‹κ°„ μ μ§€
 ___       
#### 3. κΈ°λ€ ν¨κ³Ό
   
   β… μ‹κ°„ μ •ν™•μ„± μ μ§€ β†’ NTP μ„λ²„λ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„μ μ‹κ°„ μ¤μ°¨λ¥Ό μµμ†ν™”ν•  μ μλ‹¤.
   
   β… μ„λ²„ λ¶€ν• μµμ†ν™” β†’ Chronyλ” iburst λ° makestep μ„¤μ •μ„ ν†µν•΄ ν¨μ¨μ μΌλ΅ λ™κΈ°ν™”ν•λ‹¤.
   
   β… RTC λ™κΈ°ν™” β†’ μ‹μ¤ν… μ¬λ¶€ν… ν›„μ—λ„ μ‹κ°„μ΄ μ μ§€λλ‹¤.
   
   β… λΉ λ¥Έ λ³µκµ¬ β†’ μΈν„°λ„·μ΄ λκ²¨λ„ λ΅μ»¬ μ‹κ°„μ„ κΈ°μ¤€μΌλ΅ λ™κΈ°ν™”λ¥Ό μ μ§€ν•  μ μλ‹¤.
 ___ 
#### π“ κ²°λ΅ 
μ΄ μ„¤μ •μ„ ν†µν•΄ Chrony μ„λ²„(192.168.0.4)λ” NTP μ„λ²„ μ—­ν• μ„ μν–‰ν•λ©°, ν΄λΌμ΄μ–ΈνΈ(192.168.0.x)λ“¤μ€ μ •λ°€ν• μ‹κ°„ λ™κΈ°ν™”λ¥Ό μν–‰ν•  μ μλ‹¤.

 
